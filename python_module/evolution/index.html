<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Evolution - COMETS Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../css/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Evolution";
    var mkdocs_page_input_path = "python_module/evolution.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> COMETS Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">COMETS Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Evolution</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h4 id="simulating-evolution-with-comets">Simulating evolution with COMETS</h4>
<p><code>COMETS</code> is able to perform simulations that include the appearance of mutants containing reaction deletions and additions. In this small example, we will perform a serial transfer experiment starting with a clonal <em>Escherichia coli</em> population, and simulate the random appearance of reaction deletion mutants. We will then visualize the dynamics of all genotypes in time.</p>
<h5 id="load-the-model">Load the model</h5>
<p>We start by importing the necessary libraries and loading the <em>E. coli</em> model. </p>
<pre><code class="python">import cometspy as c
import cobra.test
import os
import pandas as pd
import matplotlib.pyplot as plt

# load model 
wt = cobra.test.create_test_model(&quot;ecoli&quot;)
</code></pre>

<pre><code>Using license file /home/djordje/gurobi.lic
Academic license - for non-commercial use only
</code></pre>
<p>Remove the bounds for all exchange reactions in the model to allow them to be controlled dynamically by <code>COMETS</code> </p>
<pre><code class="python"># Remove bounds from exchange reactions
for i in wt.reactions:
    if 'EX_' in i.id:
        i.lower_bound =-1000.0
</code></pre>

<h5 id="set-up-the-layout">Set up the layout</h5>
<p>We create a well mixed environment with a glucose minimal media. Here, we use the custom <code>add_typical_trace_metabolites</code> method to add trace metabolites (ions, metals etc) in unlimited amounts (<code>static</code> flag).</p>
<pre><code class="python"># generate layout
test_tube = c.layout()
test_tube.set_specific_metabolite('glc__D_e', 0.0001)
test_tube.add_typical_trace_metabolites(amount=1000)

# add model
wt = c.model(wt)
wt.initial_pop = [0, 0, 1e-7]
test_tube.add_model(wt)
</code></pre>

<pre><code>building empty layout model
models will need to be added with layout.add_model()
Warning: The added metabolite (glc__D_e) is notable to be taken up by any of the current models
</code></pre>
<h5 id="set-up-simulation-parameters">Set up simulation parameters</h5>
<p>Create a params object, and modify the needed parameters. The simulation in this example simulation consists of 10 days of experiment, with a 1:2 transfer every 3h. The mutation rate will be <span><span class="MathJax_Preview">10^{-7}</span><script type="math/tex">10^{-7}</script></span> deletion events per reaction and generation. The <code>cellSize</code> parameter sets the amount of biomass that appears when a mutant occurs (i.e., one mutant cell appears).</p>
<pre><code class="python"># .. load parameters and layout from file
evo_params = c.params()

evo_paramsset_param('timeStep', 0.1)             # hours

evo_paramsset_param('maxCycles', 2400)            # simulate 10 serial transfers of 24h each (timeStep = 0.1)
evo_paramsset_param('batchDilution', True)
evo_paramsset_param('dilFactor', 0.5)            # Dilution to apply
evo_paramsset_param('dilTime', 3)                # hours

evo_paramsset_param('evolution', True)
evo_paramsset_param('mutRate', 1e-8)             # 
evo_paramsset_param('cellSize', 1e-10)           # cellSize should always be larger than maxSpaceBiomass
evo_paramsset_param('minSpaceBiomass', 1e-11)    # make sure it is smaller than cell size!


evo_paramsset_param('BiomassLogRate', 1)
</code></pre>

<h5 id="run-the-simulation">Run the simulation</h5>
<p>We now create the COMETS object using the above layout and parameters, and run the simulation. </p>
<pre><code class="python"># create comets object from the loaded parameters and layout 
evo_simulation = c.comets(test_tube, evo_params)
evo_simulation.JAVA_CLASSPATH = '/home/djordje/Dropbox/COMETS_RUN/lib/jmatio.jar:/home/djordje/Dropbox/COMETS_RUN/lib/jdistlib-0.4.5-bin.jar:/home/djordje/Dropbox/COMETS_RUN/lib/commons-math3-3.6.1.jar:/home/djordje/Dropbox/COMETS_RUN/lib/commons-lang3-3.9.jar:/home/djordje/Dropbox/COMETS_RUN/lib/colt.jar:/home/djordje/Dropbox/COMETS_RUN/lib/concurrent.jar:/home/djordje/Dropbox/COMETS_RUN/bin/comets_2.9.3.jar:/opt/gurobi901/linux64/lib/gurobi.jar'

# run comets simulation
evo_simulation.run()
</code></pre>

<pre><code>Warning: java class libraries cannot be found
These are the expected locations for dependencies:
Dependency           expected path
__________           _____________
junit           /home/djordje/Dropbox/COMETS_RUN/lib/junit/junit-4.12.jar
hamcrest            /home/djordje/Dropbox/COMETS_RUN/lib/junit/hamcrest-core-1.3.jar
jogl_all            /home/djordje/Dropbox/COMETS_RUN/lib/jogl/jogamp-all-platforms/jar/jogl-all.jar
gluegen_rt          /home/djordje/Dropbox/COMETS_RUN/lib/jogl/jogamp-all-platforms/jar/gluegen-rt.jar
gluegen         /home/djordje/Dropbox/COMETS_RUN/lib/jogl/jogamp-all-platforms/jar/gluegen.jar
gluegen_rt_natives          /home/djordje/Dropbox/COMETS_RUN/lib/jogl/jogamp-all-platforms/jar/gluegen-rt-natives-linux-amd64.jar
jogl_all_natives            /home/djordje/Dropbox/COMETS_RUN/lib/jogl/jogamp-all-platforms/jar/jogl-all-natives-linux-amd64.jar
jmatio          /home/djordje/Dropbox/COMETS_RUN/lib/JMatIO/lib/jamtio.jar
jmat            /home/djordje/Dropbox/COMETS_RUN/lib/JMatIO/JMatIO-041212/lib/jmatio.jar
concurrent          /home/djordje/Dropbox/COMETS_RUN/lib/colt/lib/concurrent.jar
colt            /home/djordje/Dropbox/COMETS_RUN/lib/colt/lib/colt.jar
lang3           /home/djordje/Dropbox/COMETS_RUN/lib/commons-lang3-3.7/commons-lang3-3.7.jar
math3           /home/djordje/Dropbox/COMETS_RUN/lib/commons-math3-3.6.1/commons-math3-3.6.1.jar

  You have two options to fix this problem:
1.  set each class path correctly by doing:
    comets.set_classpath(libraryname, path)
    e.g.   comets.set_classpath('hamcrest', '/home/chaco001/comets/junit/hamcrest-core-1.3.jar')

    note that versions dont always have to exactly match, but you're on your own if they don't

2.  fully define the classpath yourself by overwriting comets.JAVA_CLASSPATH
       look at the current comets.JAVA_CLASSPATH to see how this should look.

Running COMETS simulation ...
Done!
</code></pre>
<h5 id="visualize-the-results">Visualize the results</h5>
<p>We can visualize the population dynamics of all species over time (color coded) using standard Python plotting tools.</p>
<pre><code class="python">fig, ax = plt.subplots(figsize=(15, 5))

for key, grp in evo_simulation.biomass.groupby(['species']):
    ax = grp.plot(ax=ax, kind='line', x='cycle', y='biomass')
ax.get_legend().remove()
plt.yscale('log')
plt.ylabel(&quot;Biomass (gr.)&quot;)
</code></pre>

<pre><code>Text(0,0.5,'Biomass (gr.)')
</code></pre>
<p><img alt="png" src="../../img/evolution_1.png" /></p>
<p>In order to analyze the results, it is also helpful to visualize the genotypes data frame, which contains all the mutants that ever appeared during the simulation. The data frame contains three columns: The ancestor, the mutation, and the name of the resulting genotype, which is assigned as a random hash.</p>
<pre><code class="python">evo_simulation.genotypes
</code></pre>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../js/extra.js" defer></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" defer></script>
      <script src="../../mathjax-config.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

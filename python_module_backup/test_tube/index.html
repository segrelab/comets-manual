<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Test tube - COMETS Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../css/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Test tube";
    var mkdocs_page_input_path = "python_module_backup/test_tube.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> COMETS Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">COMETS</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../capabilities/">Capabilities</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../installation/">Installation</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">COMETS PYTHON TOOLBOX</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="../../python-module/getting_started.md">Getting started</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../python-module/test_tube.md">Growth in a test tube</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../python-module/competition_assay.md">Competition assay</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../python-module/chemostat.md">Continuous culture</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../python-module/evolution.md">Evolutionary processes</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../python-module/citrate.md">Citrate use in the LTEE</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../python-module/circular_colony.md">Circular colony growth</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../python-module/branching_colony.md">Branching colony growth</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../python-module/demographic_noise_two_strains.md">Demographic noise with two strains</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../python-module/petri_dish.md">Virtual Petri dish</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../python-module/soil.md">Soil-air interface</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">COMETS MATLAB TOOLBOX</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="../../colony.md">Example</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">COMETS Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Test tube</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h4 id="growth-in-a-test-tube">Growth in a test tube</h4>
<p>This simple example illustrates the basic workflow of COMETS, including how to build the simulation layout, to specify parameters, load the model and plot the data once the simulation is finished.</p>
<p>The core of the COMETS methodology is the Dynamic Flux Balance Analysis algorithm (Madahevan et al 2002). One of the first successful simulations of the time dynamics of bacterial metabolism was the classical study of <em>Escherichia coli</em> batch culture by Varma and Palsson (1994). Here, we reproduce one of the results in that study, the anaerobic fermentation in minimal media with glucose as the only carbon source.</p>
<p>We will simulate a test tube by setting a well-mixed virtual container with <span><span class="MathJax_Preview">1cm3</span><script type="math/tex">1cm3</script></span> of media, which we will inoculate with <span><span class="MathJax_Preview">5\times10^{−6}</span><script type="math/tex">5\times10^{−6}</script></span> grams of E. coli biomass. We will set the initial composition of the substrate to 11mM of glucose and unlimited amounts of ammonia and phosphate. For the nutrient uptake, we will use standard Michaelis-Menten kinetics, using the experimentally measured Monod parameter for anaerobic uptake of glucose by E. coli.</p>
<p>For this simple example, we use the rudimentary "core" model of E. coli (Orth et al. 2009), which can be downloaded from http://bigg.ucsd.edu/models/e_coli_core or loaded, as we do here, using a function built in CobraPy. This model represents an E. coli metabolism simplified to its core functions (glycolysis, tricarboxylic cycle, pentose phosphate shunt, etc).</p>
<h5 id="loading-the-comets-python-toolbox">Loading the COMETS Python Toolbox</h5>
<p>We first import the COMETS Python toolbox, which will also load all the dependencies, such as CobraPy or pandas.</p>
<pre><code class="python">import cometspy as c
import cobra.test
import matplotlib.pyplot as plt
</code></pre>

<h5 id="creating-a-test-tube">Creating a test tube</h5>
<p>We are now ready to create a "layout" for our simulation. By instantiating the class layout without arguments, we will create the default simulation layout, represents an empty, well mixed space (called "cell") with volume 1cm^3. We can then modify this layout according to our needs, in this case adding the media composition in the desired concentration.</p>
<pre><code class="python"># Create empty 1x1 layout
test_tube = c.layout()

# Add 11mM glucose and remove o2
test_tube.set_specific_metabolite('glc__D_e', 0.011)
test_tube.set_specific_metabolite('o2_e', 0)

# Add the rest of nutrients unlimited (ammonia, phosphate, water and protons)
test_tube.set_specific_metabolite('nh4_e',1000);
test_tube.set_specific_metabolite('pi_e',1000);
test_tube.set_specific_metabolite('h2o_e',1000);
test_tube.set_specific_metabolite('h_e',1000);
</code></pre>

<pre><code>building empty layout model
models will need to be added with layout.add_model()
Warning: The added metabolite (glc__D_e) is notable to be taken up by any of the current models
Warning: The added metabolite (o2_e) is notable to be taken up by any of the current models
Warning: The added metabolite (nh4_e) is notable to be taken up by any of the current models
Warning: The added metabolite (pi_e) is notable to be taken up by any of the current models
Warning: The added metabolite (h2o_e) is notable to be taken up by any of the current models
Warning: The added metabolite (h_e) is notable to be taken up by any of the current models
</code></pre>
<h5 id="loading-a-model">Loading a model</h5>
<p>Next, we have to load the model and add it to the layout (or "inoculate it in our test tube").</p>
<p>We will instantiate the comets model class using a loaded CobraPy model as input.</p>
<p>Note that we remove the bounds on glucose import, which will be set dynamically by COMETS during the simulation according to the dynamically changing external glucose concentration. We will set the initial biomass of our model at <span><span class="MathJax_Preview">10^{-6}</span><script type="math/tex">10^{-6}</script></span> grams.</p>
<pre><code class="python"># create the model using CobraPy functionality
e_coli_cobra = cobra.test.create_test_model('textbook')

# use the loaded model to build a comets model
e_coli = c.model(e_coli_cobra)

# remove the bounds from glucose import (will be set dynamically by COMETS)
e_coli.change_bounds('EX_glc__D_e', -1000, 1000)

# set the model's initial biomass
e_coli.initial_pop = [0, 0, 5e-6]

# add it to the test_tube
test_tube.add_model(e_coli)
</code></pre>

<pre><code>Using license file /home/djordje/gurobi.lic
Academic license - for non-commercial use only
</code></pre>
<h5 id="setting-the-simulation-parameters">Setting the simulation parameters</h5>
<p>We next instantiate the params class, which generates a set of parameters for the COMETS simulation with the [TODO LINK TO DEF VALS] default values for all of them. All of the parameters are contained in the all_params field which is a Python dict object, making it easy to change the value of the desired parameters.</p>
<pre><code class="python"># Set the parameters that are different from the default
sim_params = c.params()
</code></pre>

<pre><code class="python">sim_params.set_param('defaultVmax', 18.5)
sim_params.set_param('defaultKm', 0.000015)
sim_params.set_param('maxCycles', 1000)
sim_params.set_param('timeStep', 0.01)
sim_params.set_param('spaceWidth', 1)
sim_params.set_param('maxSpaceBiomass', 10)
sim_params.set_param('minSpaceBiomass', 1e-11)
sim_params.set_param('writeMediaLog', True)
</code></pre>

<h5 id="running-the-simulation">Running the simulation</h5>
<p>With all set up, we can now instantiate the comets class by passing the layout (containing the model) and the params objects we just created.</p>
<pre><code class="python">experiment = c.comets(test_tube, sim_params)
</code></pre>

<p>Finally, we can run the simulation as:</p>
<pre><code class="python">experiment.run()
</code></pre>

<pre><code>Running COMETS simulation ...
Done!
</code></pre>
<h5 id="analyzing-the-results">Analyzing the results</h5>
<p>The results of our simulation are stored in several pandas data frames contained in the comets object that we just simulated. The growth of the simulated model can be seen by plotting the total_biomass field.</p>
<pre><code class="python">ax = experiment.total_biomass.plot(x = 'cycle')
ax.set_ylabel(&quot;Biomass (gr.)&quot;)
</code></pre>

<p><img alt="png" src="../../img/test_tube_1.png" /></p>
<p>Similarly, we can plot composition of the media. In this case, we will limit the plot to those components that are not added to the layout in unlimited amounts (“static” compounds, e.g. ammonia, phosphate, water, etc in this simulation). In this case, we do this by limiting the plot to compounds with concentration lower than 900mM.</p>
<pre><code class="python">media = experiment.media.copy()
media = media[media.conc_mmol&lt;900]

fig, ax = plt.subplots()
media.groupby('metabolite').plot(x='cycle', ax =ax, y='conc_mmol')
ax.legend(('acetate','ethanol', 'formate', 'glucose'))
ax.set_ylabel(&quot;Concentration (mmol)&quot;)
</code></pre>

<p><img alt="png" src="../../img/test_tube_2.png" /></p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../js/extra.js" defer></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" defer></script>
      <script src="../../mathjax-config.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
